#! /bin/bash
#
# A script to automatically modify the "PATCH_LEVEL" in the version file when we commit. The patch level is
# incremented by one. 
#
# This file needs to be placed manually into the ".git/hooks/" directory.
# 

# path to version file
VERSION_FILE="VCPU32-Simulator/VCPU32-Version.h"

# read current patch level version
PATCH_LEVEL_CURRENT=$(grep -oP '(?<=PATCH_LEVEL \s*=\s* )\d+' "$VERSION_FILE")

echo "Current patch level" 
echo $PATCH_LEVEL_CURRENT

# increment patch level
PATCH_LEVEL=$((PATCH_LEVEL + 1))

#update patch level in file
sed -i "s/\(PATCH_LEVEL\s*=\s*\)[0-9]\+/\1$PATCH_LEVEL/" "$VERSION_FILE"

# stage the modified version file
git add "$VERSION_FILE"

# exit for git to proceed
exit 0  